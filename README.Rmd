---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, 
  comment = "#>",
  fig.path = "README-"  
)

options(width = 200)
```

# janitor
***********************
[![Travis-CI Build Status](https://travis-ci.org/sfirke/janitor.svg?branch=master)](https://travis-ci.org/sfirke/janitor)
[![Coverage Status](https://img.shields.io/codecov/c/github/sfirke/janitor/master.svg)](https://codecov.io/github/sfirke/janitor?branch=master)


**janitor** has simple little functions for examining and cleaning dirty data.  Save your brain for the fun stuff.

<hr/>
>Data scientists, according to interviews and expert estimates, spend from 50 percent to 80 percent of their time mired in this more mundane labor of collecting and preparing unruly digital data, before it can be explored for useful nuggets.
>
> -- *"[For Big-Data Scientists, 'Janitor Work' Is Key Hurdle to Insight](http://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html)" - The New York Times, 2014*

<hr/>

### Installation

janitor is not yet on CRAN.  Install the development version from GitHub:

```{r, eval = FALSE}
# install.packages("devtools")
devtools::install_github("sfirke/janitor")
```


## Using janitor

Below are quick examples of how janitor functions are commonly used.  A full description of each function can be found in janitor's [catalog of functions](https://github.com/sfirke/janitor/blob/master/vignettes/introduction.md).  

Janitor is a [#tidyverse](https://github.com/hadley/tidyverse/blob/master/vignettes/manifesto.Rmd)-oriented package.  Specifically, it plays nicely with the `%>%` pipe and is optimized for cleaning data brought in with the [readr](https://github.com/hadley/readr) and [readxl](https://github.com/hadley/readxl) packages.

### Cleaning dirty data

Take this roster of teachers at a fictional American high school, stored in the Microsoft Excel file [dirty_data.xlsx](https://github.com/sfirke/janitor/blob/master/dirty_data.xlsx):
![All kinds of dirty.](dirty_data.PNG)

It suffers from:

* Illegal, clunky, and duplicated names
* Empty columns and rows used as dividers, and rows/columns that are empty but contain Excel formatting
* Dates stored as numbers
* Values spread inconsistently over the rightmost two columns
* Missing values stored as text, i.e., "TBD" and "PENDING" should be treated as NA in this case


Here's that data after being read in to R:
```{r, warning = FALSE, message = FALSE}
library(pacman) # for loading packages
p_load(readxl, janitor, dplyr)

roster_raw <- read_excel("dirty_data.xlsx") # available at https://github.com/sfirke/janitor/blob/master/dirty_data.xlsx
roster_raw
```

The presence of Excel formatting led to an empty column on the right and empty rows below.  The (dreadful) column names are preserved, and the duplicate column names cause `dplyr` functions to choke:
```{r, error=TRUE}
names(roster_raw)
roster_raw %>%
  select(Subject, `% Allocated`)
```

Let's clean it:
```{r}
roster <- roster_raw %>%
  clean_names() %>%
  remove_empty_rows() %>%
  remove_empty_cols() %>%
  convert_to_NA(c("TBD", "PENDING")) %>%
  mutate(hire_date = excel_numeric_to_date(hire_date),
         main_cert = use_first_valid_of(certification, certification_2))

roster
```

Use `%>% clean_names()` anytime you read data into R.

### Examining dirty data

#### Finding duplicates
`get_dupes()` is for hunting down and examining duplicate records during data cleaning.  Here, let's see if any teachers are listed more than once:
```{r}
roster %>% get_dupes(first_name, last_name)
```

Yes, some teachers appear twice.  We ought to address this before counting employees.

#### Tabulating variables
janitor has several functions for quick counts.  The two major ones are `tabyl()` and `crosstab()`.

Notably, they can be called two ways:

* On vectors - e.g., `tabyl(roster$subject)`
* On a piped-in data.frame: `roster %>% tabyl(subject)`.
    * This allows for dplyr commands earlier in the pipeline

```{r}
roster %>%
  tabyl(subject)

roster %>%
  filter(hire_date > as.Date("1950-01-01")) %>%
  crosstab(employee_status, full_time)
```

Other janitor functions "prettify" the results of these tabulation calls for fast, basic reporting.  Here are some of the functions that augment tabyls and crosstabs:
```{r}
roster %>%
  tabyl(employee_status, sort = TRUE) %>%
  add_totals_row()

roster %>%
  crosstab(full_time, employee_status) %>%
  adorn_crosstab(denom = "col", show_totals = TRUE)

```


Together, these tabulation functions fill R's deficit against Excel and SPSS when it comes to quick, informative counts.

## Contact me

You are welcome to:

* submit suggestions and bug-reports: https://github.com/sfirke/janitor/issues
* send a pull request: https://github.com/sfirke/janitor/
* compose a friendly e-mail to: <img src = "http://samfirke.com/wp-content/uploads/2016/07/email_address_whitespace_top.png" alt = "samuel.firke AT gmail" width = "210"/>
